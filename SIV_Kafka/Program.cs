using DataBase;
using DataBase.Entity;
using Microsoft.Extensions.Configuration;
using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.Hosting;
using Microsoft.Extensions.Logging;
using SIV_Kafka;
using NLog;
using NLog.Extensions.Logging;

public class Program
{

    private static async Task Main(string[] args)
    {
        var host = Host.CreateDefaultBuilder(args)
            .ConfigureAppConfiguration((hostContext, config) =>
            {
                config.SetBasePath(Directory.GetCurrentDirectory());
                config.AddJsonFile("appsettings.json", optional: false, reloadOnChange: true);

            })
            .ConfigureServices((hostContext, services) =>
            {

                var configuration = hostContext.Configuration;
                services.AddSingleton(configuration);
                services.Configure<AppSettings>(configuration);

                // 配置日志  
                services.AddLogging(loggingBuilder =>
                {
                    loggingBuilder.ClearProviders();
                    loggingBuilder.AddNLog();
                });
                //services.AddAutoMapperExt();

                services.AddScoped<MyDbContext>(provider => new MyDbContext(configuration));
                //services.AddSqlSugar(configuration);

                services.AddHostedService<DataCacheService>();
                // 注册其他服务
                services.AddSingleton<KafkaService>(); // 将 KafkaService 注册为单例
                //services.AddHostedService<FaultWarnService>();
                services.AddHostedService<KafkaStartService>();

            })
            .Build();

        host.Run();

    }
    private static async Task Test()
    {


        string fileContent = "55FF6E0027D8004B0001044246030A17031C6EAA557AEF66DFB7C915AC6EFD3B0000000110000001100000011000007EC10000CAC500001EDD00008A5A0000F0B50000CD9F0000E356000062000000B2D700004A96000056970000B98E000057F9000069220000F3FD00006ED9000095D2000074000000E97D0000A511000053950000A96100002D7C00002B490000DB070000E61B0000DACE0000469F0000A62700003CF60000B13600008DB50000186E0000560800006D4000000346000094E8000030740000DC1500003AA70000105B0000EFA2000095FD000066C000003842000092970000F8AC0000E38E0000C63C0000093900006BCF0000A88A0000779200001BEF000046DA0000BAC80000E1CF000095C600009A26000039EF0000965D0000ACDE0000D8280000E14200000E9700005FC10000627B00004C18000002F6000013FD000018270000469400005AFD00003118000093130000E80600001B9E0000A7F80000EA55000061880000D1BE0000E682000090310000465900005A4700005A6F00001DA8000035C00000D3CA00002DED000003DF0000708800005FD20000A9AB0000DDBE00009DE500004AEC0000C77600003D8C0000B7F3000098C700000031000027F900005D9E0000D3260000642500007CCD00006AB4000022B700003FEF0000D7090DB1AA5567FEA93B58EA15AC6EFD7B1F0000011000000110000001100000BBF00000BD8D000055C80000119B000074C500002B6C000075BD0000AF8A0000B5B30000CA770000FCB100008715000046E5000034FA000097440000B85B0000D5A50000438600005B3E00001CCF0000F54D0000ACB600008A2500008F0700005DC90000EA76000044AF0000E6A40000E2070000D8720000B1A50000C8100000231E0000BFE00000A6790000949F00009C480000FA080000765B0000E738000093720000BBAB000084BA000076470000748400008253000029C100005F6700002BE700003834000088930000D9F200002BFF000095DC000084120000EE7D0000121D0000B3540000367100004865000079DC00003F620000DCD100009B1A00000F4E000060260000102B00008B3D0000A39200001EB4000022EA00004D9900009C000000E2BF00002320000048270000E8300000A9A00000A0C50000824D00004813000043D30000B5910000A23A0000B1520000D54C0000707B00008893000011B0000032DD0000977B0000667A000000B200005A10000084B2000047880000A28F00007DEC000086BC0000E93C0000CD160000F234000007D6000034C400001AEB0000C8580000C2EB00009C840000AC82000053E0000007C34369BE2D";

        var ysbwModel = new TB_YSBW()
        {
            ysbw = fileContent
        };
        var data = KafkaParse.GetKafkaData(ysbwModel);
    }
}
